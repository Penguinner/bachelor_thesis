name	postgresql	duckdb	sparql
Get all Trees	SELECT osm_id FROM planet_osm_point WHERE natural = 'tree';	"SELECT id FROM osm WHERE map_contains_entry(tags, ""natural"", ""tree"");"	"PREFIX geo: <http://www.opengis.net/ont/geosparql#> PREFIX osmkey: <https://www.openstreetmap.org/wiki/Key:> SELECT ?osm_id ?geometry WHERE {?osm_id osmkey:natural ""tree"" . ?osm_id geo:hasGeometry/geo:asWKT ?geometry .}"
Get all Buildings in BW	WITH bw AS ( SELECT way AS geom FROM planet_osm_polygon WHERE osm_id = 62611) SELECT osm_id FROM planet_osm_points WHERE building IS NOT NULL AND ST_Contains(SELECT geom FROM bw, way) UNION SELECT osm_id FROM planet_osm_line WHERE building IS NOT NULL AND ST_Contains(SELECT geom FROM bw, way) UNION SELECT osm_id FROM planet_osm_polygon WHERE building IS NOT NULL AND ST_Contains(SELECT geom FROM bw, way);	WITH bw AS (SELECT id, tags, refs, ref_types, ref_roles FROM osm WHERE id = 62611),bw_ways AS (SELECT DISTINCT UNNEST(bw.refs) as way_id FROM bw WHERE bw.ref_types[array_position(bw.refs, UNNEST(mb.refs))] = 'way'),way_nodes AS (SELECT w.id as way_id, UNNEST(w.refs), n.lat, n.lon, row_number() OVER (PARTITION BY w.id ORDER BY array_position(w.refs, UNNEST(w.refs))) as order FROM osm JOIN bw_ways ON w.id = bw_ways.way_id JOIN osm n ON n.id = UNNEST(w.refs) AND n.kind = 'node' WHERE w.kind = 'way'),bw_geom AS (SELECT ST_MakePolygon(ST_MakeLine(ARRAY_AGG(ST_Point(lon, lat) ORDER BY order))) as geom FROM way_nodes GROUP BY way_id)SELECT id,tags,kind,ST_Point(lon, lat) as geometry,'node' as source_type,NULL as refs FROM osn CROSS JOIN bw_geom WHERE kind = 'node'AND tags['building'] IS NOT NULL AND ST_Contains(bw_geom.geom, ST_Point(lon, lat)) UNION ALL SELECT w.id,w.tags,w.kind,CASE WHEN w.refs[1] = w.refs[array_length(w.refs)] THEN ST_MakePolygon(ST_MakeLine(ARRAY_AGG(ST_Point(n.lon, n.lat) ORDER BY array_position(w.refs, n.id))))ELSE NULL END as geometry,'way' as source_type,w.refs FROM osm w CROSS JOIN UNNEST(w.refs) as node_id JOIN osm n ON n.id = node_id AND n.kind = 'node' CROSS JOIN bw_geom WHERE w.kind = 'way'AND w.tags['building'] IS NOT NULL AND ST_Contains(bw_geom.geom, ST_MakeLine(ARRAY_AGG(ST_Point(n.lon, n.lat) ORDER BY array_position(w.refs, n.id)))) GROUP BY w.id, w.tags, w.kind, w.refs HAVING w.refs[1] = w.refs[array_length(w.refs)] UNION ALL SELECT r.id,r.tags,r.kind,ST_Collect(ARRAY_AGG(ST_MakePolygon(ST_MakeLine(ARRAY_AGG(ST_Point(n.lon, n.lat) ORDER BY array_position(w.refs, n.id)))))) as geometry,'relation' as source_type,r.refs FROM osm r CROSS JOIN UNNEST(r.refs) as member_id JOIN osm w ON w.id = member_id AND w.kind = 'way' CROSS JOIN UNNEST(w.refs) as node_id JOIN osm n ON n.id = node_id AND n.kind = 'node' CROSS JOIN bw_geom WHERE r.kind = 'relation' AND r.tags['type'] = 'multipolygon' AND r.tags['building'] IS NOT NULL AND w.refs[1] = w.refs[array_length(w.refs)] AND ST_Contains(bw_geom.geom, ST_Collect(ARRAY_AGG(ST_MakePolygon(ST_MakeLine(ARRAY_AGG(ST_Point(n.lon, n.lat) ORDER BY array_position(w.refs, n.id)))))))GROUP BY r.id, r.tags, r.kind, r.refs	PREFIX ogc: <http://www.opengis.net/rdf#> PREFIX osmrel: <https://www.openstreetmap.org/relation/> PREFIX geo: <http://www.opengis.net/ont/geosparql#> PREFIX osm: <https://www.openstreetmap.org/> PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> PREFIX osmkey: <https://www.openstreetmap.org/wiki/Key:> SELECT ?osm_id ?shape WHERE { osmrel:62611 ogc:sfContains ?osm_id . ?osm_id osmkey:building ?building . ?osm_id rdf:type osm:way . ?osm_id geo:hasGeometry/geo:asWKT ?shape}
Get all railways	SELECT osm_id FROM planet_osm_line WHERE railway IS NOT NULL;	"SELECT id FROM osm WHERE map_contains(tags, ""railway"") AND kind = 'way';"	PREFIX osm: <https://www.openstreetmap.org/> PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> PREFIX geo: <http://www.opengis.net/ont/geosparql#> PREFIX osmkey: <https://www.openstreetmap.org/wiki/Key:> SELECT ?osm_id ?geometry WHERE { ?osm_id osmkey:railway ?highway . ?osm_id rdf:type osm:way . ?osm_id geo:hasGeometry ?geometry .}
All buildings around Freiburg in a Star Polygon	WITH star AS (SELECT ST_PolygonFromText('POLYGON ((9.184578963305599 47.999, 8.385144147952545 48.264788183611195, 8.256948814252292 48.85910862978201, 7.6346755928738546 48.429054314891005, 6.7560117040949095 48.53057636722238, 7.170860518347201 47.999, 6.7560117040949095 47.467423632777624, 7.6346755928738546 47.568945685109, 8.256948814252292 47.138891370218, 8.385144147952545 47.73321181638881, 9.184578963305599 47.999))') as geom) SELECT osm_id  FROM planet_osm_points WHERE building IS NOT NULL AND ST_Contains(SELECT geom FROM star, way) UNION SELECT osm_id FROM planet_osm_line WHERE building IS NOT NULL AND ST_Contains(SELECT geom FROM star, way) UNION SELECT osm_id FROM planet_osm_polygon WHERE building IS NOT NULL AND ST_Contains(SELECT geom FROM star, way);	WITH star AS (SELECT ST_GeomFromText('POLYGON ((9.184578963305599 47.999, 8.385144147952545 48.264788183611195, 8.256948814252292 48.85910862978201, 7.6346755928738546 48.429054314891005, 6.7560117040949095 48.53057636722238, 7.170860518347201 47.999, 6.7560117040949095 47.467423632777624, 7.6346755928738546 47.568945685109, 8.256948814252292 47.138891370218, 8.385144147952545 47.73321181638881, 9.184578963305599 47.999))') as geom) SELECT id,tags,kind,ST_Point(lon, lat) as geometry,'node' as source_type,NULL as refs FROM osm CROSS JOIN star WHERE kind = 'node' AND tags['building'] IS NOT NULL AND ST_Contains(star.geom, ST_Point(lon, lat)) UNION ALL SELECT w.id,w.tags,w.kind,CASE WHEN w.refs[1] = w.refs[array_length(w.refs)] THEN ST_MakePolygon(ST_MakeLine(ARRAY_AGG(ST_Point(n.lon, n.lat) ORDER BY array_position(w.refs, n.id))))ELSE NULL END as geometry,'way' as source_type,w.refs FROM osm w CROSS JOIN UNNEST(w.refs) as node_id JOIN osm n ON n.id = node_id AND n.kind = 'node' CROSS JOIN star WHERE w.kind = 'way'AND w.tags['building'] IS NOT NULL AND ST_Contains(star.geom, ST_MakeLine(ARRAY_AGG(ST_Point(n.lon, n.lat) ORDER BY array_position(w.refs, n.id)))) GROUP BY w.id, w.tags, w.kind, w.refsHAVING w.refs[1] = w.refs[array_length(w.refs)] UNION ALL SELECT r.id,r.tags,r.kind,ST_Collect(ARRAY_AGG(ST_MakePolygon(ST_MakeLine(ARRAY_AGG(ST_Point(n.lon, n.lat) ORDER BY array_position(w.refs, n.id)))))) as geometry,'relation' as source_type,r.refs FROM osm r CROSS JOIN UNNEST(r.refs) as member_id JOIN osm w ON w.id = member_id AND w.kind = 'way' CROSS JOIN UNNEST(w.refs) as node_id JOIN osm n ON n.id = node_id AND n.kind = 'node' CROSS JOIN star WHERE r.kind = 'relation' AND r.tags['type'] = 'multipolygon' AND r.tags['building'] IS NOT NULL AND w.refs[1] = w.refs[array_length(w.refs)] AND ST_Contains(star.geom, ST_Collect(ARRAY_AGG(ST_MakePolygon(ST_MakeLine(ARRAY_AGG(ST_Point(n.lon, n.lat) ORDER BY array_position(w.refs, n.id))))))) GROUP BY r.id, r.tags, r.kind, r.refs;	"PREFIX osmkey: <https://www.openstreetmap.org/wiki/Key:> PREFIX osmrel: <https://www.openstreetmap.org/relation/> PREFIX ogc: <http://www.opengis.net/rdf#> PREFIX geo: <http://www.opengis.net/ont/geosparql#> PREFIX geof: <http://www.opengis.net/def/function/geosparql/> SELECT ?building ?building_geometry WHERE {  VALUES ?star { ""POLYGON ((9.184578963305599 47.999, 8.385144147952545 48.264788183611195, 8.256948814252292 48.85910862978201, 7.6346755928738546 48.429054314891005, 6.7560117040949095 48.53057636722238, 7.170860518347201 47.999, 6.7560117040949095 47.467423632777624, 7.6346755928738546 47.568945685109, 8.256948814252292 47.138891370218, 8.385144147952545 47.73321181638881, 9.184578963305599 47.999))""^^geo:wktLiteral }  VALUES ?region { osmrel:51477 osmrel:51701 osmrel:2202162 } ?region ogc:sfContains ?building . ?building osmkey:building [] . ?building geo:hasGeometry/geo:asWKT ?building_geometry . FILTER geof:sfContains(?star,?building_geometry)}"
All buildings near a big lake	WITH lakes AS (SELECT way FROM planet_osm_polygon WHERE water = 'lake') SELECT osm_id FROM planet_osm_point osm JOIN lakes l ON osm.building IS NOT NULL AND ST_DWithin(l.way, osm.way, 700.0);	WITH lake_bboxes AS ( SELECT w.id, w.tags['name'] as lake_name, ST_Envelope(ST_MakePolygon(ST_MakeLine(ARRAY_AGG(ST_Point(n.lon, n.lat) ORDER BY array_position(w.refs, n.id))))) as bbox, ST_MakePolygon(ST_MakeLine(ARRAY_AGG(ST_Point(n.lon, n.lat) ORDER BY array_position(w.refs, n.id)))) as geometry,ST_Buffer(ST_MakePolygon(ST_MakeLine(ARRAY_AGG(ST_Point(n.lon, n.lat) ORDER BY array_position(w.refs, n.id))))::GEOGRAPHY, 700) as buffer_700m FROM osm w CROSS JOIN UNNEST(w.refs) as node_id JOIN osm n ON n.id = node_id AND n.kind = 'node' WHERE w.kind = 'way' AND w.refs[1] = w.refs[array_length(w.refs)] AND (w.tags['natural'] = 'water' OR w.tags['water'] = 'lake') GROUP BY w.id, w.tags HAVING ST_Area(ST_MakePolygon(ST_MakeLine( ARRAY_AGG( ST_Point(n.lon, n.lat) ORDER BY array_position(w.refs, n.id))))::GEOGRAPHY) > 1000000),building_points AS (SELECT n.id, n.tags, 'node' as source_type, ST_Point(n.lon, n.lat) as point_geom FROM osm n WHERE n.kind = 'node' AND n.tags['building'] IS NOT NULL UNION ALL SELECT w.id,w.tags,'way' as source_type,ST_Centroid(ST_MakePolygon(ST_MakeLine(ARRAY_AGG(ST_Point(n.lon, n.lat) ORDER BY array_position(w.refs, n.id))))) as point_geom FROM osm w CROSS JOIN UNNEST(w.refs) as node_id JOIN osm n ON n.id = node_id AND n.kind = 'node' WHERE w.kind = 'way' AND w.tags['building'] IS NOT NULL AND w.refs[1] = w.refs[array_length(w.refs)] GROUP BY w.id, w.tags) SELECT bp.id FROM building_points bp JOIN lake_bboxes lb ON bp.point_geom && lb.buffer_700m WHERE ST_DWithin(bp.point_geom::GEOGRAPHY, lb.geometry::GEOGRAPHY, 700) ORDER BY lb.lake_name, distance_meters;	"PREFIX osm2rdf: <https://osm2rdf.cs.uni-freiburg.de/rdf#> PREFIX osmkey: <https://www.openstreetmap.org/wiki/Key:> PREFIX osmrel: <https://www.openstreetmap.org/relation/> PREFIX ogc: <http://www.opengis.net/rdf#> PREFIX geo: <http://www.opengis.net/ont/geosparql#> PREFIX unit: <http://qudt.org/vocab/unit/> PREFIX geof: <http://www.opengis.net/def/function/geosparql/>PREFIX unit: <http://qudt.org/vocab/unit/> SELECT DISTINCT ?building ?area ?building_geom WHERE {?lake osmkey:water ""lake"" . ?lake osm2rdf:area ?area FILTER (?area >= 1000000) ?lake geo:hasGeometry/geo:asWKT ?lake_geom .?building osmkey:building [] . ?building geo:hasGeometry/geo:asWKT ?building_geom .FILTER (geof:distance(?building_geom,?lake_geom,unit:M) <= 700)}"