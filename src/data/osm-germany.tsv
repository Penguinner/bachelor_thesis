name	postgresql	duckdb	sparql
Get all Trees	SELECT osm_id FROM planet_osm_point WHERE planet_osm_point.natural = 'tree';	SELECT id FROM osm WHERE tags IS NOT NULL AND tags['natural'] = 'tree';	PREFIX geo: <http://www.opengis.net/ont/geosparql#> PREFIX osmkey: <https://www.openstreetmap.org/wiki/Key:> SELECT ?osm_id ?geometry WHERE {?osm_id osmkey:natural 'tree' . ?osm_id geo:hasGeometry/geo:asWKT ?geometry .}
Get all Buildings in BW	WITH bw AS (SELECT way AS geom FROM planet_osm_polygon WHERE osm_id=-62611) SELECT osm_id FROM planet_osm_point JOIN bw ON ST_Contains(bw.geom, planet_osm_point.way) AND building IS NOT NULL UNION SELECT osm_id FROM planet_osm_line JOIN bw ON ST_Contains(bw.geom, planet_osm_line.way) AND building IS NOT NULL UNION SELECT osm_id FROM planet_osm_polygon JOIN bw ON ST_Contains(bw.geom, planet_osm_polygon.way) AND building IS NOT NULL;	WITH bw_ways AS (SELECT generate_subscripts(refs, 1) as way_index, unnest(refs) AS ref, unnest(ref_types) AS type, unnest(ref_roles) as role FROM osm WHERE id = 62611), bw_points AS (SELECT bw_ways.way_index, generate_subscripts(osm.refs, 1) as point_index, unnest(osm.refs) AS ref FROM osm JOIN bw_ways ON bw_ways.ref = osm.id AND bw_ways.type = 'way' AND bw_ways.role = 'outer'), ord_points AS (SELECT ST_POINT(osm.lon,osm.lat) AS geom, way_index FROM osm JOIN bw_points ON bw_points.ref = osm.id ORDER BY way_index, point_index), ord_lines AS (SELECT ST_MakeLine(ARRAY_AGG(geom)) AS line FROM ord_points GROUP BY way_index), bw_polygons AS (SELECT ST_Polygonize(list(line)) as geom FROM ord_lines), buildings AS (SELECT id, ST_Point(lon,lat) as geom FROM osm JOIN bw_polygons ON tags['building'] IS NOT NULL AND kind = 'node' UNION ALL SELECT w.id as id, ST_MakeLine(list(ST_Point(p.lon,p.lat))) as geom FROM osm w JOIN unnest(refs) AS r(ref) ON w.kind = 'way' JOIN osm p ON p.id = r.ref GROUP BY w.id UNION ALL SELECT rel_id as id, ST_Polygonize(list(geom)) as geom FROM (SELECT rel_id, way_id, ST_MakeLine(list(point)) as geom FROM (SELECT rel_id, rel_idx, way_id, way_idx, ST_Point(g.lat, g.lon) as point FROM (SELECT r.id as rel_id, index as rel_idx, w.id as way_id, generate_subscripts(w.refs, 1) as way_idx, unnest(w.refs) as p_id FROM (SELECT id, index, ref FROM (SELECT id, generate_subscripts(refs, 1) as index, unnest(refs) as ref, unnest(ref_roles) as role FROM osm WHERE kind = 'relation' AND tags['building'] IS NOT NULL) WHERE role = 'outer') r JOIN osm w ON r.ref = w.id) as p JOIN osm g ON p.p_id = g.id ORDER BY rel_id, rel_idx, way_idx) GROUP BY rel_id, way_id) GROUP BY rel_id) SELECT id FROM buildings b JOIN bw_polygons p ON ST_Contains(p.geom, b.geom);	PREFIX ogc: <http://www.opengis.net/rdf#> PREFIX osmrel: <https://www.openstreetmap.org/relation/> PREFIX geo: <http://www.opengis.net/ont/geosparql#> PREFIX osm: <https://www.openstreetmap.org/> PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> PREFIX osmkey: <https://www.openstreetmap.org/wiki/Key:> SELECT ?osm_id ?shape WHERE { osmrel:62611 ogc:sfContains ?osm_id . ?osm_id osmkey:building ?building . ?osm_id rdf:type osm:way . ?osm_id geo:hasGeometry/geo:asWKT ?shape}
Get all railways	SELECT osm_id FROM planet_osm_line WHERE railway IS NOT NULL;	SELECT id FROM osm WHERE map_contains(tags, 'railway') AND kind = 'way';	PREFIX osm: <https://www.openstreetmap.org/> PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> PREFIX geo: <http://www.opengis.net/ont/geosparql#> PREFIX osmkey: <https://www.openstreetmap.org/wiki/Key:> SELECT ?osm_id ?geometry WHERE { ?osm_id osmkey:railway ?highway . ?osm_id rdf:type osm:way . ?osm_id geo:hasGeometry ?geometry .}
All buildings around Freiburg in a Star Polygon	WITH star AS (SELECT ST_Transform(ST_PolygonFromText('POLYGON ((9.184578963305599 47.999, 8.385144147952545 48.264788183611195, 8.256948814252292 48.85910862978201, 7.6346755928738546 48.429054314891005, 6.7560117040949095 48.53057636722238, 7.170860518347201 47.999, 6.7560117040949095 47.467423632777624, 7.6346755928738546 47.568945685109, 8.256948814252292 47.138891370218, 8.385144147952545 47.73321181638881, 9.184578963305599 47.999))', 4326), 3857) as geom) SELECT osm_id FROM planet_osm_point JOIN star ON ST_Contains(star.geom, planet_osm_point.way) AND building IS NOT NULL UNION SELECT osm_id FROM planet_osm_line JOIN star ON ST_Contains(star.geom, planet_osm_line.way) AND building IS NOT NULL UNION SELECT osm_id FROM planet_osm_polygon JOIN star ON ST_Contains(star.geom, planet_osm_polygon.way) AND building IS NOT NULL;	WITH star AS (SELECT ST_GeomFromText('POLYGON ((9.184578963305599 47.999, 8.385144147952545 48.264788183611195, 8.256948814252292 48.85910862978201, 7.6346755928738546 48.429054314891005, 6.7560117040949095 48.53057636722238, 7.170860518347201 47.999, 6.7560117040949095 47.467423632777624, 7.6346755928738546 47.568945685109, 8.256948814252292 47.138891370218, 8.385144147952545 47.73321181638881, 9.184578963305599 47.999))') as geom), buildings AS (SELECT id, ST_Point(lon,lat) as geom FROM osm WHERE tags['building'] IS NOT NULL AND kind = 'node' UNION ALL SELECT w.id as id, ST_MakeLine(list(ST_Point(p.lon,p.lat))) as geom FROM osm w JOIN unnest(refs) AS r(ref) ON w.kind = 'way' JOIN osm p ON p.id = r.ref GROUP BY w.id UNION ALL SELECT rel_id as id, ST_Polygonize(list(geom)) as geom FROM (SELECT rel_id, way_id, ST_MakeLine(list(point)) as geom FROM (SELECT rel_id, rel_idx, way_id, way_idx, ST_Point(g.lat, g.lon) AS point FROM (SELECT r.id as rel_id, index as rel_idx, w.id as way_id, generate_subscripts(w.refs, 1) as way_idx, unnest(w.refs) as p_id FROM (SELECT id, index, ref FROM (SELECT id, generate_subscripts(refs, 1) as index, unnest(refs) as ref, unnest(ref_roles) as role FROM osm WHERE kind = 'relation' AND tags['building']  IS NOT NULL) WHERE role = 'outer') r JOIN osm w ON r.ref = w.id) as p JOIN osm g ON p.p_id = g.id ORDER BY rel_id, rel_idx, way_idx) GROUP BY rel_id, way_id) GROUP BY rel_id ) SELECT id FROM buildings b JOIN star p ON ST_Contains(p.geom, b.geom);	PREFIX osmkey: <https://www.openstreetmap.org/wiki/Key:> PREFIX osmrel: <https://www.openstreetmap.org/relation/> PREFIX ogc: <http://www.opengis.net/rdf#> PREFIX geo: <http://www.opengis.net/ont/geosparql#> PREFIX geof: <http://www.opengis.net/def/function/geosparql/> SELECT ?building ?building_geometry WHERE {  VALUES ?star { 'POLYGON ((9.184578963305599 47.999, 8.385144147952545 48.264788183611195, 8.256948814252292 48.85910862978201, 7.6346755928738546 48.429054314891005, 6.7560117040949095 48.53057636722238, 7.170860518347201 47.999, 6.7560117040949095 47.467423632777624, 7.6346755928738546 47.568945685109, 8.256948814252292 47.138891370218, 8.385144147952545 47.73321181638881, 9.184578963305599 47.999))'^^geo:wktLiteral }  VALUES ?region { osmrel:51477 osmrel:51701 osmrel:2202162 } ?region ogc:sfContains ?building . ?building osmkey:building [] . ?building geo:hasGeometry/geo:asWKT ?building_geometry . FILTER geof:sfContains(?star,?building_geometry)}
All buildings near a big lake	WITH lakes AS (SELECT way FROM planet_osm_polygon WHERE water = 'lake') SELECT osm_id FROM planet_osm_point osm JOIN lakes l ON osm.building IS NOT NULL AND ST_DWithin(l.way, osm.way, 700.0) UNION SELECT osm_id FROM planet_osm_line osm JOIN lakes l ON osm.building IS NOT NULL AND ST_DWithin(l.way, osm.way, 700.0) UNION SELECT osm_id FROM planet_osm_polygon osm JOIN lakes l ON osm.building IS NOT NULL AND ST_DWithin(l.way, osm.way, 700.0);	WITH lakes AS (SELECT id, ST_Transform(ST_Buffer(ST_Transform(geom, 'EPSG:4326', 'EPSG:3857'), 700), 'EPSG:3857', 'EPSG:4326') as buffer FROM (SELECT way_id as id, ST_Polygonize([ST_MakeLine(list(ST_Point(lat,lon)))]) as geom FROM (SELECT * FROM (SELECT id as way_id, unnest(refs) as pref, generate_subscripts(refs, 1) as index FROM osm WHERE tags['natural'] = 'water' AND tags['water'] = 'lake' AND kind = 'way') w JOIN osm p ON w.pref = p.id AND p.kind = 'node' ORDER BY way_id, index) GROUP BY way_id UNION ALL SELECT r.id, ST_Polygonize(list(line)) as geom FROM (SELECT r.rel_id as id, r.rel_idx, r.way_id, ST_MakeLine(list(ST_Point(r.lat, r.lon))) as line FROM (SELECT * FROM (SELECT rel_id, index as rel_idx, w.id as way_id, generate_subscripts(w.refs, 1) as w_idx, unnest(w.refs) as pref FROM (SELECT id as rel_id, unnest(refs) as wref, unnest(ref_roles) as role, generate_subscripts(refs, 1) as index FROM osm WHERE tags['natural'] = 'water' AND tags['water'] = 'lake' AND kind = 'relation') r JOIN osm w ON r.wref = w.id and r.role = 'outer') w JOIN osm p ON w.pref = p.id AND p.kind = 'node' ORDER BY rel_id, rel_idx, way_id, w_idx) r GROUP BY r.rel_id, r.rel_idx, r.way_id ORDER BY r.rel_id, r.rel_idx) r GROUP BY r.id) l WHERE ST_Area_Spheroid(geom) > 1000000), buildings AS (SELECT id, ST_Point(lon,lat) as geom FROM osm WHERE tags['building'] IS NOT NULL AND kind = 'node' UNION ALL SELECT w.id as id, ST_MakeLine(list(ST_Point(p.lon,p.lat))) as geom FROM osm w JOIN unnest(refs) AS r(ref) ON w.kind = 'way' JOIN osm p ON p.id = r.ref GROUP BY w.id UNION ALL SELECT rel_id as id, ST_Polygonize(list(geom)) as geom FROM (SELECT rel_id, way_id, ST_MakeLine(list(point)) as geom FROM (SELECT rel_id, rel_idx, way_id, way_idx, ST_Point(g.lat, g.lon) as point FROM (SELECT r.id as rel_id, index as rel_idx, w.id as way_id, generate_subscripts(w.refs, 1) as way_idx, unnest(w.refs) as p_id FROM (SELECT id, index, ref FROM (SELECT id, generate_subscripts(refs, 1) as index, unnest(refs) as ref, unnest(ref_roles) as role FROM osm WHERE kind = 'relation' AND tags['building'] IS NOT NULL) WHERE role = 'outer') r JOIN osm w ON r.ref = w.id) as p JOIN osm g ON p.p_id = g.id ORDER BY rel_id, rel_idx, way_idx) GROUP BY rel_id, way_id) GROUP BY rel_id) SELECT b.id FROM buildings b JOIN lakes l ON ST_Contains(l.buffer, b.geom);	PREFIX osm2rdf: <https://osm2rdf.cs.uni-freiburg.de/rdf#> PREFIX osmkey: <https://www.openstreetmap.org/wiki/Key:> PREFIX osmrel: <https://www.openstreetmap.org/relation/> PREFIX ogc: <http://www.opengis.net/rdf#> PREFIX geo: <http://www.opengis.net/ont/geosparql#> PREFIX unit: <http://qudt.org/vocab/unit/> PREFIX geof: <http://www.opengis.net/def/function/geosparql/>PREFIX unit: <http://qudt.org/vocab/unit/> SELECT DISTINCT ?building ?area ?building_geom WHERE {?lake osmkey:water 'lake' . ?lake osm2rdf:area ?area FILTER (?area >= 1000000) ?lake geo:hasGeometry/geo:asWKT ?lake_geom . ?building osmkey:building [] . ?building geo:hasGeometry/geo:asWKT ?building_geom . FILTER (geof:distance(?building_geom, ?lake_geom,unit:M) <= 700)}
